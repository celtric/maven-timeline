<html>
<head>
  <title>Maven Timeline</title>
  <script src="maven-timeline.js" type="text/javascript"></script>
  <script src="database.js" type="text/javascript"></script>
  <script src="timeline.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script>

  <!-- Compiled and minified CSS -->
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">-->

  <!-- Compiled and minified JavaScript -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>-->

  <script>
    function onLoad() {
      var timelineData = window.timelineData;
      if(timelineData == undefined) {
        $.ajax({
          url: "maven-timeline.json",
          dataType: "json",
          async: false
        }).done(function (data) {
          timelineData = data
        });
      }
      timeLineDb = new TimeLineDb(timelineData);
      timeLine = new TimeLine(timelineData);

      timeLine.render(2);

      var cardTitles = ["Summary by phase","Summary by goal","Summary by artifact","Summary by track"];

      for(var i = 0; i < cardTitles.length; i++) {
        var summary = document.createElement("div");
        summary.setAttribute("class", "summary");
        var h2 = document.createElement("h2");
        h2.innerText = cardTitles[i];
        summary.appendChild(h2);
        document.getElementsByTagName("aside")[0].appendChild(summary);
      }

      function elem(tagName, content) {
        var element = document.createElement(tagName);
        element.innerText = content;
        return element;
      }

      timeLineDb.getPhases(function(tx, rs) {
        for (var i = 0; i < rs.rows.length; i++) {
          var phase = rs.rows.item(i).phase;
          timeLineDb.getTotalPhaseDuration(phase, function (duration, phase) {
            var container = document.createElement("div");
            container.appendChild(elem("span", phase));
            container.appendChild(elem("span", duration));
            document.getElementsByClassName("summary")[0].appendChild(container);
            });
        }
      });
      timeLineDb.getGoals(function(tx, rs) {
        for (var i = 0; i < rs.rows.length; i++) {
          var goal = rs.rows.item(i).goal;
          timeLineDb.getTotalGoalDuration(goal, function (duration, goal) {
            var container = document.createElement("div");
            container.appendChild(elem("span", goal));
            container.appendChild(elem("span", duration));
            document.getElementsByClassName("summary")[1].appendChild(container);
            });
        }
      });
      timeLineDb.getArtifactIds(function(tx, rs) {
        for (var i = 0; i < rs.rows.length; i++) {
          var artId = rs.rows.item(i).artifactId;
          timeLineDb.getTotalArtifactDuration(artId, function (duration, artId) {
            var container = document.createElement("div");
            container.appendChild(elem("span", artId));
            container.appendChild(elem("span", duration));
            document.getElementsByClassName("summary")[2].appendChild(container);
            });
        }
      });
      timeLineDb.getTracks(function(tx, rs) {
        for (var i = 0; i < rs.rows.length; i++) {
          var track = rs.rows.item(i).trackNum;
          timeLineDb.getTotalTrackDuration(track, function (duration, track) {
            var container = document.createElement("div");
            container.appendChild(elem("span", track));
            container.appendChild(elem("span", duration));
            document.getElementsByClassName("summary")[3].appendChild(container);
            });
        }
      });
    }
  </script>
  <link rel="stylesheet" type="text/css" href="style.css"></link>
</head>
<body onload="onLoad();">
<main>
  <h1>Time line</h1>
  <div id="timeLineContainer"></div>
</main>
<aside></aside>
</body>
</html>
