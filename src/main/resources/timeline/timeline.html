<html>
<head>
  <title>Maven Timeline</title>
  <script src="maven-timeline.js" type="text/javascript"></script>
  <script src="database.js" type="text/javascript"></script>
  <script src="timeline.js" type="text/javascript"></script>
  <script src="https://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script>

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <!--<link rel="stylesheet" href="/resources/demos/style.css">-->
  <!--<script src="https://code.jquery.com/jquery-1.12.4.js"></script>-->
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

  <!-- Compiled and minified CSS -->
  <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/css/materialize.min.css">-->

  <!-- Compiled and minified JavaScript -->
  <!--<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.8/js/materialize.min.js"></script>-->

  <script>
    function onLoad() {
      var timelineData = window.timelineData;
      if(timelineData == undefined) {
        $.ajax({
          url: "maven-timeline.json",
          dataType: "json",
          async: false
        }).done(function (data) {
          timelineData = data
        });
      }
      timeLineDb = new TimeLineDb(timelineData);
      timeLine = new TimeLine(timelineData);

      timeLineDb.getTrackCount(function(count) {
        document.getElementById("timeLineContainer").setAttribute("style", "height:" + (40 + ((count+1) * 80)) + "px");
      });

      var zoomMin = 1;
      var zoomMax = Math.max(zoomMin, (timelineData.end - timelineData.start) / 500);
      var zoomDefault = Math.max(zoomMin, zoomMax / 3);

      timeLine.render(zoomDefault);

      var cardTitles = ["Controls","Summary by phase","Summary by goal","Summary by artifact","Summary by track"];

      for(var i = 0; i < cardTitles.length; i++) {
        var summary = document.createElement("div");
        summary.setAttribute("class", "summary");
        var h2 = document.createElement("h2");
        h2.innerText = cardTitles[i];
        summary.appendChild(h2);
        document.getElementsByTagName("aside")[0].appendChild(summary);
      }

      function elem(tagName, content) {
        var element = document.createElement(tagName);
        element.innerText = content;
        return element;
      }

      timeLineDb.getTotalPhaseDuration(function (phase, duration) {
        var container = document.createElement("div");
        container.appendChild(elem("span", phase));
        container.appendChild(elem("span", duration));
        document.getElementsByClassName("summary")[1].appendChild(container);
      });
      timeLineDb.getTotalGoalDuration(function (goal, duration) {
        var container = document.createElement("div");
        container.appendChild(elem("span", goal));
        container.appendChild(elem("span", duration));
        document.getElementsByClassName("summary")[2].appendChild(container);
      });
      timeLineDb.getTotalArtifactDuration(function (artId, duration) {
        var container = document.createElement("div");
        container.appendChild(elem("span", artId));
        container.appendChild(elem("span", duration));
        document.getElementsByClassName("summary")[3].appendChild(container);
      });
      timeLineDb.getTotalTrackDuration(function (track, duration) {
        var container = document.createElement("div");
        container.appendChild(elem("span", track));
        container.appendChild(elem("span", duration));
        document.getElementsByClassName("summary")[4].appendChild(container);
      });

      var sliderContainer = document.createElement("div");
      var slider = document.createElement("div");
      slider.setAttribute("id", "zoomSlider");
      sliderContainer.appendChild(elem("span", "Zoom"));
      sliderContainer.appendChild(slider);
      document.getElementsByClassName("summary")[0].appendChild(sliderContainer);
      $( function() {
        $( "#zoomSlider" ).slider({min:zoomMin, max:zoomMax, step: 1, value: zoomDefault,
          change: function(ev, ui) {
          timeLine.render(ui.value);
        }});
      } );
    }
  </script>
  <link rel="stylesheet" type="text/css" href="style.css"></link>
</head>
<body onload="onLoad();">
<header>
  <h1>Time line</h1>
</header>
<main>
  <div id="timeLineContainer"></div>
</main>
<aside></aside>
</body>
</html>
